---
phase: 03-multi-session-orchestration
plan: 02
type: execute
wave: 2
depends_on:
  - 03-01
files_modified:
  - src-tauri/src/session/supervisor.rs
  - src-tauri/src/session/manager.rs
  - src-tauri/src/session/mod.rs
  - src-tauri/src/commands/session.rs
  - src-tauri/src/bin/lulu_test_cli.rs
  - src-tauri/tests/multi_session_orchestration.rs
autonomous: true
must_haves:
  truths:
    - User can run 3-5 sessions in parallel without one session blocking others
    - If one session crashes or exits with error, other sessions continue running
    - Running indicator can stop immediately on terminal transition because terminal updates are emitted once and promptly
  artifacts:
    - path: src-tauri/src/session/supervisor.rs
      provides: Independent per-session runtime supervision and terminal guards
    - path: src-tauri/src/commands/session.rs
      provides: Multi-session spawn/terminal orchestration through supervisor integration
    - path: src-tauri/tests/multi_session_orchestration.rs
      provides: Integration proof for 3-5 concurrent sessions and crash isolation behavior
  key_links:
    - from: src-tauri/src/commands/session.rs
      to: src-tauri/src/session/supervisor.rs
      via: register and monitor each spawned session independently
      pattern: supervisor\.|SessionSupervisor
    - from: src-tauri/src/session/supervisor.rs
      to: src-tauri/src/db/session.rs
      via: single terminal transition update per session
      pattern: transition_session_terminal|update_session_status
    - from: src-tauri/src/session/supervisor.rs
      to: session-event
      via: status emit on start/terminal boundaries
      pattern: emit\("session-event"
---

<objective>
Harden runtime concurrency so multi-session execution (3-5 sessions) is truly parallel with isolated failure domains and deterministic terminal signaling.

Purpose: satisfy SESS-01 and LIFE-03 by ensuring each session has independent supervision, cancellation, and terminal transition handling.
Output: SessionSupervisor runtime integration and deterministic parallel orchestration tests.
</objective>

<execution_context>
@/Users/timothyshortt/.config/opencode/get-shit-done/workflows/execute-plan.md
@/Users/timothyshortt/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/REQUIREMENTS.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-multi-session-orchestration/03-RESEARCH.md
@.planning/phases/03-multi-session-orchestration/03-01-PLAN.md
@src-tauri/src/commands/session.rs
@src-tauri/src/session/manager.rs
</context>

<tasks>

<task type="auto">
  <name>Introduce SessionSupervisor for independent per-session runtime domains</name>
  <files>src-tauri/src/session/supervisor.rs, src-tauri/src/session/manager.rs, src-tauri/src/session/mod.rs, src-tauri/src/commands/session.rs</files>
  <action>Create `SessionSupervisor` that tracks each session with isolated process handle, terminal guard, and cancellation context so one session's failure never mutates another session's runtime state. Keep lock scope short and avoid shared await-heavy critical sections. Emit lifecycle transitions promptly so frontend can stop running pulse immediately when terminal state is reached.</action>
  <verify>cd src-tauri && cargo test --test multi_session_orchestration -- --nocapture</verify>
  <done>Supervisor can manage at least 5 concurrent sessions, each with independent start/terminal handling and no cross-session terminal corruption.</done>
</task>

<task type="auto">
  <name>Add integration coverage for parallel throughput and crash isolation</name>
  <files>src-tauri/src/bin/lulu_test_cli.rs, src-tauri/tests/multi_session_orchestration.rs, src-tauri/src/commands/session.rs</files>
  <action>Extend test fixture modes so one session can fail while others complete, then add orchestration integration tests that launch 3-5 sessions concurrently and assert: all sessions progress independently, terminal status updates are emitted once, failed session maps to dashboard `failed`, and unaffected sessions remain `running/completed` as expected.</action>
  <verify>cd src-tauri && cargo test --test multi_session_orchestration</verify>
  <done>Automated tests prove crash isolation and parallel orchestration behavior under mixed success/failure outcomes.</done>
</task>

</tasks>

<verification>
Run `cd src-tauri && cargo test --test multi_session_orchestration` and confirm mixed-outcome parallel session scenarios pass without flaky timing or shared-state bleed.
</verification>

<success_criteria>
The runtime can sustain 3-5 simultaneous sessions where a failed/crashed session transitions to Failed without interrupting unrelated sessions.
</success_criteria>

<output>
After completion, create `.planning/phases/03-multi-session-orchestration/03-multi-session-orchestration-02-SUMMARY.md`
</output>
