---
phase: 03-multi-session-orchestration
plan: 05
type: execute
wave: 3
depends_on:
  - 03-03
files_modified:
  - src/lib/stores/sessions.ts
  - src/routes/+page.svelte
  - src/lib/components/MainArea.svelte
  - src/lib/components/MainArea.test.ts
  - src/lib/__tests__/sessions.dashboard.test.ts
autonomous: true
gap_closure: true
must_haves:
  truths:
    - App startup does not flash the dashboard list before showing the New Session startup view when the initial snapshot is empty
    - Startup view selection is deterministic on first load and only occurs after initial session hydration is marked ready
    - Existing sessions still render in stable newest-first order after readiness completes, with locked status vocabulary unchanged (Starting/Running/Completed/Failed)
  artifacts:
    - path: src/lib/stores/sessions.ts
      provides: First-load readiness signal tied to initial session snapshot hydration
    - path: src/routes/+page.svelte
      provides: Bootstrap choreography that marks first-load readiness after initial list hydration completes
    - path: src/lib/components/MainArea.svelte
      provides: Startup render gate that suppresses intermediate pre-ready frames and deterministically chooses startup/list/detail branches
    - path: src/lib/components/MainArea.test.ts
      provides: Component-level regression coverage for startup gating and empty initial snapshot behavior
    - path: src/lib/__tests__/sessions.dashboard.test.ts
      provides: Store-level regression coverage for readiness transition and locked list behavior post-hydration
  key_links:
    - from: src/routes/+page.svelte
      to: src/lib/stores/sessions.ts
      via: bootstrap marks first-load ready only after initial loadSessionsWithRetry completes
      pattern: loadSessionsWithRetry|set.*Ready|mark.*Ready
    - from: src/lib/stores/sessions.ts
      to: src/lib/components/MainArea.svelte
      via: MainArea gates initial branching on explicit readiness signal instead of raw live session stores
      pattern: initial.*ready|first.*load|startup
    - from: src/lib/components/MainArea.svelte
      to: src/lib/__tests__/sessions.dashboard.test.ts
      via: tests assert no transient dashboard-list frame appears before ready state is true
      pattern: no.*blink|startup.*stable|ready
---

<objective>
Close the Phase 3 startup render stability regression so first paint is deterministic and does not transiently show the dashboard list before the New Session startup view.

Purpose: unblock SESS-02 verification by adding a first-load readiness boundary between async bootstrap and startup/list/detail rendering.
Output: readiness-gated startup flow in store/page/component plus regression coverage for no-blink startup behavior.
</objective>

<execution_context>
@/Users/timothyshortt/.config/opencode/get-shit-done/workflows/execute-plan.md
@/Users/timothyshortt/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/REQUIREMENTS.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-multi-session-orchestration/03-CONTEXT.md
@.planning/phases/03-multi-session-orchestration/03-RESEARCH.md
@.planning/phases/03-multi-session-orchestration/03-multi-session-orchestration-VERIFICATION.md
@.planning/phases/03-multi-session-orchestration/03-multi-session-orchestration-03-SUMMARY.md
@src/routes/+page.svelte
@src/lib/stores/sessions.ts
@src/lib/components/MainArea.svelte
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add explicit first-load readiness state and bootstrap handshake</name>
  <files>src/lib/stores/sessions.ts, src/routes/+page.svelte</files>
  <action>Add an explicit first-load readiness signal in the sessions store (default false on app start), expose a clear API to mark initial hydration complete, and wire `+page.svelte` bootstrap so readiness flips only after the first `loadSessionsWithRetry` attempt resolves (success or controlled empty result). Keep backend/frontend projection boundary intact per research and do not alter locked status vocabulary, ordering rules, or row field contract.</action>
  <verify>npm run test:unit -- sessions.dashboard</verify>
  <done>Startup readiness is represented as explicit store state, and app bootstrap publishes first-load completion deterministically instead of leaving render timing implicit.</done>
</task>

<task type="auto">
  <name>Task 2: Gate MainArea initial rendering to suppress pre-ready frames</name>
  <files>src/lib/components/MainArea.svelte, src/lib/components/MainArea.test.ts</files>
  <action>Refactor MainArea branch selection to honor first-load readiness before evaluating live session/selection stores, so initial render cannot show a transient dashboard list frame. Ensure empty initial snapshot deterministically shows the New Session startup view, and preserve existing locked interactions (single-click select, double-click open) and stable newest-first list behavior once ready. Avoid auto-reorder behavior or any new status text/progress indicators.</action>
  <verify>npm run test:unit -- MainArea</verify>
  <done>MainArea has a deterministic startup gate: before ready it shows startup-safe UI, after ready it switches to startup/list/detail without intermediate flicker.</done>
</task>

<task type="auto">
  <name>Task 3: Add regression tests for no-blink startup stability</name>
  <files>src/lib/components/MainArea.test.ts, src/lib/__tests__/sessions.dashboard.test.ts, src/lib/stores/sessions.ts</files>
  <action>Add deterministic regression coverage for the failed truth: verify that with an initially empty snapshot the app does not render dashboard-list content before readiness is true, then lands on New Session startup view; verify that when sessions exist, list rendering occurs only post-readiness and retains locked status set (`Starting/Running/Completed/Failed`) plus stable newest-first ordering. Use controlled store transitions/mocks rather than timing sleeps.</action>
  <verify>npm run test:unit -- sessions.dashboard MainArea</verify>
  <done>Automated tests fail if startup rendering regresses back to transient list blink or if post-ready list behavior drifts from locked decisions.</done>
</task>

</tasks>

<verification>
Run `npm run test:unit -- sessions.dashboard MainArea` and confirm startup-readiness and no-blink regression assertions pass.
</verification>

<success_criteria>
Phase 3 startup render gap is closed: first load is readiness-gated, empty initial snapshot reliably shows New Session startup view with no transient list blink, and locked dashboard behavior remains unchanged after readiness.
</success_criteria>

<output>
After completion, create `.planning/phases/03-multi-session-orchestration/03-multi-session-orchestration-05-SUMMARY.md`
</output>
