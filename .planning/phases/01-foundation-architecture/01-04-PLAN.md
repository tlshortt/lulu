---
phase: 01-foundation-architecture
plan: "04"
type: execute
wave: 2
depends_on:
  - "01"
files_modified:
  - svelte.config.js
  - src/routes/+page.svelte
autonomous: false
gap_closure: true
must_haves:
  truths:
    - "App launches to the dark UI shell with sidebar labels (Lulu, Mission Control), New Session button, and empty-state hint."
    - "Svelte UI renders on load without blank white window regressions."
    - "Session listeners initialize on app load without repeated setup."
  artifacts:
    - path: "svelte.config.js"
      provides: "Svelte compiler runes enabled"
      contains: "runes: true"
    - path: "src/routes/+page.svelte"
      provides: "App shell bootstraps listeners on mount"
      contains: "onMount"
  key_links:
    - from: "svelte.config.js"
      to: "Svelte compiler"
      via: "compilerOptions.runes"
      pattern: "compilerOptions\\s*:\\s*\\{\\s*runes:\\s*true"
    - from: "src/routes/+page.svelte"
      to: "$lib/stores/sessions"
      via: "onMount initSessionListeners + loadSessions"
      pattern: "onMount\\(.*initSessionListeners\\(\\).*loadSessions\\(\\)"
---

<objective>
Fix the app shell white-window regression so the Svelte UI renders correctly on launch.

Purpose: Restore the expected dark UI shell at startup so UAT can proceed.
Output: Svelte config with runes enabled and app shell initialization adjusted.
</objective>

<execution_context>
@/Users/timothyshortt/.config/opencode/get-shit-done/workflows/execute-plan.md
@/Users/timothyshortt/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation-architecture/01-UAT.md
</context>

<tasks>

<task type="auto">
  <name>Enable Svelte 5 runes in compiler config</name>
  <files>svelte.config.js</files>
  <action>Add a top-level compilerOptions block with runes: true so Svelte 5 runes compile cleanly. Keep the existing adapter-static SPA configuration intact.</action>
  <verify>Open svelte.config.js and confirm compilerOptions.runes is set to true.</verify>
  <done>Runes are enabled in the Svelte compiler configuration.</done>
</task>

<task type="auto">
  <name>Stabilize app-shell initialization on mount</name>
  <files>src/routes/+page.svelte</files>
  <action>Replace the $effect-based listener bootstrap with an onMount hook to run initSessionListeners() and loadSessions() once on first render. Keep the New Session open/close handlers and modal wiring intact.</action>
  <verify>Confirm +page.svelte uses onMount for initSessionListeners/loadSessions and no longer relies on $effect for this setup.</verify>
  <done>Listener initialization runs once on mount without requiring $effect reactivity.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Checkpoint: Verify app shell renders correctly</name>
  <files>svelte.config.js, src/routes/+page.svelte</files>
  <action>Human verification required to confirm the UI renders after the fix.</action>
  <verify>Follow the verification steps below.</verify>
  <done>User confirms the dark UI shell and empty state are visible.</done>
  <what-built>App shell startup fix for Svelte UI rendering</what-built>
  <how-to-verify>
    1. Run: npm run tauri dev
    2. Confirm the app opens to a dark UI shell (no blank white window).
    3. Verify the left sidebar shows “Lulu” and “Mission Control”.
    4. Verify the “New Session” button is visible and the main area shows the “No active sessions” empty state with the ⌘ + N hint.
  </how-to-verify>
  <resume-signal>Type "approved" or describe what is still broken.</resume-signal>
</task>

</tasks>

<verification>
UAT Test 1 (Launch app shell) passes after the fix.
</verification>

<success_criteria>
- App launches with the dark UI shell and no white window regression.
- Sidebar labels and empty-state hint are visible as specified in UAT Test 1.
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-architecture/01-04-SUMMARY.md`
</output>
