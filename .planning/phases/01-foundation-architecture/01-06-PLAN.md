---
phase: 01-foundation-architecture
plan: "06"
type: execute
wave: 2
depends_on:
  - "01"
  - "02"
files_modified:
  - package.json
  - eslint.config.js
  - prettier.config.cjs
  - .prettierignore
  - vite.config.ts
  - src/test/setup.ts
  - src/lib/__tests__/smoke.test.ts
  - src-tauri/Cargo.toml
  - rustfmt.toml
  - clippy.toml
  - src-tauri/src/db/mod.rs
autonomous: true
user_setup: []

must_haves:
  truths:
    - "Linting and formatting are enforced for both frontend and Rust"
    - "Frontend unit tests run under Vitest"
    - "Rust unit tests run with cargo test"
  artifacts:
    - path: "eslint.config.js"
      provides: "ESLint configuration for Svelte + TypeScript"
    - path: "prettier.config.cjs"
      provides: "Prettier configuration with Svelte support"
    - path: "vite.config.ts"
      provides: "Vitest configuration"
    - path: "src/lib/__tests__/smoke.test.ts"
      provides: "Frontend unit test scaffold"
    - path: "rustfmt.toml"
      provides: "Rust formatting rules"
    - path: "clippy.toml"
      provides: "Clippy lint configuration"
    - path: "src-tauri/src/db/mod.rs"
      provides: "Rust unit test for database init"
  key_links:
    - from: "package.json"
      to: "eslint.config.js"
      via: "npm run lint"
      pattern: "\"lint\"\s*:.*eslint"
    - from: "package.json"
      to: "prettier.config.cjs"
      via: "npm run format:check"
      pattern: "\"format:check\"\s*:.*prettier"
    - from: "package.json"
      to: "vite.config.ts"
      via: "npm run test:unit"
      pattern: "\"test:unit\"\s*:.*vitest"
    - from: "src-tauri/src/db/mod.rs"
      to: "rustfmt.toml"
      via: "cargo fmt --all -- --check"
      pattern: "rustfmt"
---

<objective>
Add linting/formatting enforcement and unit-test scaffolding for both the Svelte frontend and Rust backend.

Purpose: Enforce code quality from day one and provide runnable unit test harnesses on both sides of the stack.
Output: ESLint/Prettier + Vitest setup, rustfmt/clippy config, and initial unit tests.
</objective>

<execution_context>
@./.opencode/get-shit-done/workflows/execute-plan.md
@./.opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation-architecture/01-CONTEXT.md
@.planning/phases/01-foundation-architecture/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Configure ESLint + Prettier + Vitest for frontend unit tests</name>
  <files>package.json, eslint.config.js, prettier.config.cjs, .prettierignore, vite.config.ts, src/test/setup.ts, src/lib/__tests__/smoke.test.ts</files>
  <action>
1. Install frontend dev dependencies: eslint, @eslint/js, eslint-plugin-svelte, svelte-eslint-parser, prettier, prettier-plugin-svelte, vitest, jsdom.
2. Create eslint.config.js for Svelte 5 + TypeScript:
   - Use @eslint/js recommended rules.
   - Use svelte-eslint-parser for .svelte files with TypeScript enabled.
3. Add prettier.config.cjs and .prettierignore (dist, build, .svelte-kit, node_modules).
4. Update package.json scripts:
   - "lint": "eslint ."
   - "format": "prettier . --write"
   - "format:check": "prettier . --check"
   - "test:unit": "vitest run"
5. Update vite.config.ts with Vitest config:
   - test.environment = "jsdom"
   - test.setupFiles = "src/test/setup.ts"
6. Create src/test/setup.ts with minimal Vitest setup.
7. Add src/lib/__tests__/smoke.test.ts with a basic `describe`/`it`/`expect` to verify the harness runs.
  </action>
  <verify>Run `npm run lint` and `npm run test:unit` - both complete without errors</verify>
  <done>Frontend lint/format scripts exist and Vitest runs a smoke test</done>
</task>

<task type="auto">
  <name>Task 2: Enforce rustfmt/clippy and add a Rust unit test scaffold</name>
  <files>src-tauri/Cargo.toml, rustfmt.toml, clippy.toml, src-tauri/src/db/mod.rs, package.json</files>
  <action>
1. Add dev-dependency to src-tauri/Cargo.toml:
   - `tempfile = "3"`
2. Add rustfmt.toml with explicit edition and formatting defaults (no experimental options).
3. Add clippy.toml with `warn = ["clippy::all"]` and keep defaults minimal.
4. Update package.json scripts to include Rust checks:
   - "format:rust": "cd src-tauri && cargo fmt --all"
   - "format:rust:check": "cd src-tauri && cargo fmt --all -- --check"
   - "lint:rust": "cd src-tauri && cargo clippy --all-targets --all-features -- -D warnings"
   - "test:rust": "cd src-tauri && cargo test"
5. Add a unit test in src-tauri/src/db/mod.rs:
   - Create a temp directory, build a db path, call `init_database(&path)`.
   - Assert the database file exists and no error is returned.
  </action>
  <verify>Run `npm run format:rust:check`, `npm run lint:rust`, and `npm run test:rust`</verify>
  <done>Rust formatting/lint commands succeed and a database init unit test passes</done>
</task>

</tasks>

<verification>
- [ ] `npm run lint` and `npm run format:check` succeed
- [ ] `npm run test:unit` succeeds (Vitest)
- [ ] `npm run format:rust:check` and `npm run lint:rust` succeed
- [ ] `npm run test:rust` succeeds
</verification>

<success_criteria>
Linting and formatting are enforced for both stacks, and unit test harnesses run on both frontend and Rust backend.
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-architecture/01-06-SUMMARY.md`
</output>
