---
phase: 06-persistence-history
plan: 03
type: execute
wave: 3
depends_on:
  - 06-02
files_modified:
  - src/lib/stores/sessions.ts
  - src/lib/__tests__/sessions.dashboard.test.ts
autonomous: true
gap_closure: true
must_haves:
  truths:
    - Reopened dashboard still starts in locked Phase 6 default ordering during startup lock (active-first, then recent).
    - If a sort preference was previously saved, it is automatically applied to active dashboard sort mode after the startup lock window without manual reselection.
    - Remembered sort mode persists across restarts and drives post-startup dashboard ordering for normal interaction.
  artifacts:
    - path: src/lib/stores/sessions.ts
      provides: startup-to-preference sort handoff that keeps startup default lock intact and then restores persisted sort mode.
    - path: src/lib/__tests__/sessions.dashboard.test.ts
      provides: deterministic regressions proving startup lock behavior and post-lock remembered sort restoration.
  key_links:
    - from: src/lib/stores/sessions.ts
      to: localStorage dashboardSortPreference
      via: startup completion path hands off from default startup mode to persisted preference mode
      pattern: dashboardSortPreference|dashboardSortMode|startup
    - from: src/lib/stores/sessions.ts
      to: src/lib/__tests__/sessions.dashboard.test.ts
      via: store startup hydration tests verify lock-first then remembered-sort handoff behavior
      pattern: startup|remembered sort|dashboard
---

<objective>
Close the Phase 6 verification gap where remembered dashboard sort is persisted but not restored into active sort mode after startup lock.

Purpose: satisfy the remaining failed must-have from verification while preserving locked Phase 6 startup-default behavior.
Output: store-level startup handoff from default sort to persisted preference plus regression coverage that fails on future drift.
</objective>

<execution_context>
@/Users/timothyshortt/.config/opencode/get-shit-done/workflows/execute-plan.md
@/Users/timothyshortt/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/REQUIREMENTS.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-persistence-history/06-CONTEXT.md
@.planning/phases/06-persistence-history/06-persistence-history-VERIFICATION.md
@.planning/phases/06-persistence-history/06-persistence-history-02-SUMMARY.md
@src/lib/stores/sessions.ts
@src/lib/__tests__/sessions.dashboard.test.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Apply remembered sort to active mode after startup lock</name>
  <files>src/lib/stores/sessions.ts</files>
  <action>Update dashboard startup-state handling so `dashboardSortMode` starts with the locked Phase 6 startup default (`active-first-then-recent`) and then, once the startup lock window completes, automatically switches to persisted `dashboardSortPreference` when present. Keep startup-default-first behavior intact per locked user decision from `06-CONTEXT.md`; do not bypass startup lock and do not require user to reselect sort manually for restore to take effect.</action>
  <verify>npm run test:unit -- sessions.dashboard</verify>
  <done>Saved preference is automatically restored into active sort mode after startup lock, while initial reopen still renders using startup default ordering.</done>
</task>

<task type="auto">
  <name>Task 2: Add regression coverage for startup lock to remembered-sort handoff</name>
  <files>src/lib/__tests__/sessions.dashboard.test.ts, src/lib/stores/sessions.ts</files>
  <action>Add or update store tests to assert this exact sequence: (1) initial reopen uses startup default ordering, (2) persisted `dashboardSortPreference` is loaded, (3) active `dashboardSortMode` transitions to that preference after startup lock completes, and (4) no manual sort reselection is required. Include one negative assertion proving behavior fails if startup mode remains stuck on default despite persisted preference.</action>
  <verify>npm run test:unit -- sessions.dashboard</verify>
  <done>Unit tests enforce lock-first behavior and automatic remembered-sort restoration so the verification truth can be revalidated as passing.</done>
</task>

</tasks>

<verification>
Run `npm run test:unit -- sessions.dashboard` and confirm startup sort tests prove both locked default-on-open and automatic post-lock remembered-sort restoration.
</verification>

<success_criteria>
Phase 6 gap is closed: dashboard honors startup default ordering on reopen and then restores persisted sort preference into active mode automatically after startup lock.
</success_criteria>

<output>
After completion, create `.planning/phases/06-persistence-history/06-persistence-history-03-SUMMARY.md`
</output>
