---
phase: 05-session-lifecycle-control
plan: 02
type: execute
wave: 2
depends_on:
  - 05-01
files_modified:
  - src/lib/types/session.ts
  - src/lib/stores/sessions.ts
  - src/lib/components/Sidebar.svelte
  - src/lib/components/SessionOutput.svelte
  - src/lib/components/Sidebar.test.ts
  - src/lib/components/SessionOutput.test.ts
  - src/lib/__tests__/sessions.dashboard.test.ts
autonomous: true
must_haves:
  truths:
    - User can interrupt from both dashboard row and session detail with confirmation text "Interrupt session?"
    - During interrupting/resuming, only the targeted session disables interrupt, resume, and prompt input controls
    - Successful interrupt keeps the user on the current view and shows Interrupted status with compact row feedback
    - User can resume a completed or interrupted session with a new prompt and see continued output history
    - Interrupt/resume failures surface clear per-session errors without impacting other session controls
  artifacts:
    - path: src/lib/stores/sessions.ts
      provides: session-scoped interrupt/resume invoke APIs, operation gates, and per-session error state
    - path: src/lib/components/Sidebar.svelte
      provides: row-level interrupt action with locked compact feedback (status chip + inline spinner)
    - path: src/lib/components/SessionOutput.svelte
      provides: detail-panel interrupt/resume controls and disabled states tied to per-session operation state
    - path: src/lib/types/session.ts
      provides: frontend lifecycle vocabulary/types including Interrupted and operation-gate status payloads
    - path: src/lib/components/Sidebar.test.ts
      provides: UI regression coverage for dashboard interrupt confirmation/feedback behavior
    - path: src/lib/components/SessionOutput.test.ts
      provides: UI regression coverage for detail interrupt/resume controls and per-session disable rules
  key_links:
    - from: src/lib/components/Sidebar.svelte
      to: src/lib/stores/sessions.ts
      via: dashboard interrupt action triggers store interrupt API and uses session-scoped operation state for compact spinner/chip
      pattern: interruptSession|Interrupting|sessionOperations
    - from: src/lib/components/SessionOutput.svelte
      to: src/lib/stores/sessions.ts
      via: detail controls call interrupt/resume APIs and disable prompt/controls only for active operation on that session
      pattern: resumeSession|interruptSession|disabled
    - from: src/lib/stores/sessions.ts
      to: src/lib/__tests__/sessions.dashboard.test.ts
      via: status mapping and error extraction include Interrupted vocabulary without cross-session leakage
      pattern: Interrupted|session_errors|dashboardRows
---

<objective>
Deliver the Phase 5 lifecycle UI and store wiring so users can safely interrupt and resume sessions with per-session operation gating and clear isolated error feedback.

Purpose: complete the user-facing LIFE-01/LIFE-02/LIFE-04 contract using the backend lifecycle APIs from plan 05-01.
Output: dashboard/detail interrupt and resume controls, session-scoped disable/error behavior, and frontend regression tests.
</objective>

<execution_context>
@/Users/timothyshortt/.config/opencode/get-shit-done/workflows/execute-plan.md
@/Users/timothyshortt/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/REQUIREMENTS.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-session-lifecycle-control/05-CONTEXT.md
@.planning/phases/05-session-lifecycle-control/05-RESEARCH.md
@.planning/phases/03-multi-session-orchestration/03-multi-session-orchestration-03-SUMMARY.md
@.planning/phases/05-session-lifecycle-control/05-session-lifecycle-control-01-SUMMARY.md
@src/lib/stores/sessions.ts
@src/lib/components/Sidebar.svelte
@src/lib/components/SessionOutput.svelte
@src/lib/types/session.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add session-scoped interrupt and resume store actions with operation gates</name>
  <files>src/lib/types/session.ts, src/lib/stores/sessions.ts, src/lib/__tests__/sessions.dashboard.test.ts</files>
  <action>Add typed frontend lifecycle support for `interrupting`, `interrupted`, and `resuming`, plus store APIs that invoke backend `interrupt_session` and `resume_session`. Enforce per-session operation state keyed by `session_id` so only the targeted session disables controls while other sessions remain interactive. Keep status and dashboard mappings aligned with locked vocabulary, including explicit `Interrupted` display (not `Failed`), and preserve the no-extra-timeline-event rule for successful interrupt. Surface interrupt retry/deadline failures as session-scoped errors without mutating global UI state.</action>
  <verify>npm run test:unit -- sessions.dashboard</verify>
  <done>Store layer exposes interrupt/resume actions with session-scoped in-flight/error state, and dashboard projection logic reflects Interrupted as a first-class status.</done>
</task>

<task type="auto">
  <name>Task 2: Implement locked interrupt/resume controls in dashboard and detail views</name>
  <files>src/lib/components/Sidebar.svelte, src/lib/components/SessionOutput.svelte, src/lib/stores/sessions.ts</files>
  <action>Implement interrupt entry points in both dashboard rows and session detail panel. Require confirmation on every interrupt using exact copy `Interrupt session?`. After confirm, show `Interrupting...` and disable interrupt, resume, and prompt input controls for that session only. For dashboard rows, keep feedback compact to status chip plus inline spinner only; do not expand row and do not auto-navigate. On successful interrupt, keep the user on the current view and show `Interrupted`. Add resume action for completed/interrupted sessions with new prompt composition interaction (Claude discretion) while preserving single-row session continuity and no keyboard shortcut for interrupt in this phase.</action>
  <verify>npm run test:unit -- Sidebar SessionOutput</verify>
  <done>Both row and detail flows support locked interrupt behavior and resume entry, with session-scoped disabled states and uninterrupted navigation context.</done>
</task>

<task type="auto">
  <name>Task 3: Add frontend regression tests for lifecycle controls and isolation</name>
  <files>src/lib/components/Sidebar.test.ts, src/lib/components/SessionOutput.test.ts, src/lib/__tests__/sessions.dashboard.test.ts</files>
  <action>Add deterministic tests that verify interrupt confirmation text, compact dashboard interrupt feedback, session-scoped control disabling, successful Interrupted rendering, and resume availability for completed/interrupted sessions. Include isolation assertions proving a failed interrupt/retry timeout in one session does not disable or error other session rows/detail panels. Keep tests free of timing flakiness by controlling store state and mocked invoke responses.</action>
  <verify>npm run test:unit -- sessions.dashboard Sidebar SessionOutput</verify>
  <done>Frontend tests fail if locked interrupt/resume UX behavior drifts or if operation/error state leaks across sessions.</done>
</task>

</tasks>

<verification>
Run `npm run test:unit -- sessions.dashboard Sidebar SessionOutput` and confirm lifecycle control behavior passes across store and component coverage.
</verification>

<success_criteria>
Phase 5 UI contract is met: interrupt is available in row and detail with locked confirmation and compact feedback, Interrupted status is visible and stable, resume works on completed/interrupted sessions, and errors remain isolated to the affected session.
</success_criteria>

<output>
After completion, create `.planning/phases/05-session-lifecycle-control/05-session-lifecycle-control-02-SUMMARY.md`
</output>
